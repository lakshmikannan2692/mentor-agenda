<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mentor 1:1 Agenda – Postdoc Dashboard</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --card:#0b1224;        /* deep */
      --muted:#94a3b8;       /* slate-400 */
      --text:#e5e7eb;        /* gray-200 */
      --brand:#38bdf8;       /* sky-400 */
      --accent:#a78bfa;      /* violet-400 */
      --ok:#34d399;          /* emerald-400 */
      --warn:#fbbf24;        /* amber-400 */
      --danger:#f87171;      /* red-400 */
      --border:#1f2937;      /* gray-800 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      color:var(--text); background:linear-gradient(180deg,#0b1224, #0a0f1e 40%, #0b1224);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:24px;}
    header{
      display:flex; flex-wrap:wrap; gap:16px; align-items:center; justify-content:space-between;
      padding:16px 20px; border:1px solid var(--border); border-radius:16px; background:rgba(17,24,39,.5); backdrop-filter: blur(6px);
      position:sticky; top:12px; z-index:5;
    }
    header h1{font-size:20px;margin:0;font-weight:650;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input[type="text"], input[type="url"], textarea{
      background:#0a0f1e; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none; width:100%;
    }
    input[type="text"]:focus, textarea:focus, input[type="url"]:focus{border-color:#334155; box-shadow:0 0 0 3px rgba(56,189,248,.15)}
    textarea{min-height:110px; resize:vertical}
    .grid{display:grid; grid-template-columns:1fr; gap:16px; margin-top:18px}
    @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }

    .card{
      border:1px solid var(--border); background:linear-gradient(180deg, rgba(17,24,39,.8), rgba(15,23,42,.6));
      border-radius:16px; padding:16px 16px 12px; box-shadow:0 6px 24px rgba(0,0,0,.25);
    }
    .card h2{margin:0 0 8px 0; font-size:16px; font-weight:650}
    .muted{color:var(--muted); font-size:12px; margin:4px 0 10px}

    .toolbar{display:flex; flex-wrap:wrap; gap:8px}
    button{
      border:1px solid var(--border); background:#0a0f1e; color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; font-size:13px;
      transition:transform .05s ease, border-color .2s, background .2s;
    }
    button:hover{border-color:#334155}
    button:active{transform:translateY(1px)}
    .primary{background:linear-gradient(90deg, var(--brand), var(--accent)); color:#081018; border:none}
    .success{border-color:rgba(52,211,153,.4);}
    .danger{border-color:rgba(248,113,113,.4)}

    .kvs{display:flex; gap:12px; flex-wrap:wrap}
    .kvs .item{display:flex; flex-direction:column; gap:6px; min-width:220px; flex:1}

    /* Checklist */
    .checklist{display:flex; flex-direction:column; gap:10px}
    .li{display:flex; align-items:center; gap:10px; background:#0a0f1e; border:1px solid var(--border); border-radius:10px; padding:8px}
    .li input[type="checkbox"]{width:18px; height:18px}
    .li input[type="text"]{flex:1; border:none; background:transparent; padding:6px 8px}
    .li .del{border-color:rgba(248,113,113,.2)}

    .links{display:flex; flex-wrap:wrap; gap:8px}
    .pill{border:1px dashed #334155; color:var(--brand); padding:6px 10px; border-radius:999px; text-decoration:none; font-weight:600}

    footer{color:var(--muted); font-size:12px; margin:24px 0 40px}

    /* Print (Save as PDF) */
    @media print{
      header, .noprint{display:none !important}
      body{background:white; color:black}
      .wrap{max-width:100%; padding:0}
      .card{box-shadow:none; background:white; border-color:#e5e7eb}
      .li{border-color:#e5e7eb; background:white}
      input, textarea{border:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Mentor 1:1 Agenda</h1>
        <div class="sub">For weekly research check-ins – grants • papers • data • next steps</div>
      </div>
      <div class="row">
        <button class="primary" id="pdfBtn" title="Print/Save as PDF">Save PDF</button>
        <button id="newBtn" title="Clear this week (keeps quick links)">New Week</button>
        <button id="exportBtn" title="Download your data as JSON">Export</button>
        <button id="importBtn" title="Import data from JSON">Import</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <section class="card">
      <h2>Top Bar</h2>
      <div class="muted">Auto-fills the date. Add your mentor name and any quick links (Drive folders, Overleaf, GitHub, Notion, etc.).</div>
      <div class="kvs">
        <div class="item">
          <label for="mtgDate">Meeting Date</label>
          <input id="mtgDate" type="text" />
        </div>
        <div class="item">
          <label for="mentor">Mentor</label>
          <input id="mentor" type="text" placeholder="e.g., Dr. Kramer" />
        </div>
      </div>
      <div style="height:8px"></div>
      <div class="links" id="links"></div>
      <div class="toolbar noprint" style="margin-top:10px">
        <input id="linkLabel" type="text" placeholder="Link label (e.g., K99 folder)" style="max-width:260px">
        <input id="linkUrl" type="url" placeholder="https://..." style="min-width:280px">
        <button id="addLink">Add Link</button>
        <button id="clearLinks" class="danger">Clear Links</button>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <h2>Last Week’s Follow‑ups</h2>
        <div class="muted">Open items from previous meeting.</div>
        <div id="followups" class="checklist"></div>
        <div class="toolbar noprint">
          <button data-add="#followups">+ Add item</button>
          <button id="clearFollowups" class="danger">Clear</button>
        </div>
      </section>

      <section class="card">
        <h2>This Week’s Agenda</h2>
        <div class="muted">Points to discuss now.</div>
        <div id="agenda" class="checklist"></div>
        <div class="toolbar noprint">
          <button data-add="#agenda">+ Add item</button>
          <button id="carryFollowups" class="success" title="Copy any unchecked Follow-ups here">Carry over unchecked from Follow‑ups → Agenda</button>
          <button id="clearAgenda" class="danger">Clear</button>
        </div>
      </section>

      <section class="card">
        <h2>Grants</h2>
        <div class="muted">Status, deadlines, blockers (e.g., K99/R00, NIW, internal calls).</div>
        <textarea id="grants" placeholder="• K99 resubmission – aims tightened, mentor letters pending
• Aging Initiative – LOI due Sept 10
• Budget draft needs revision (personnel fringe)"></textarea>
      </section>

      <section class="card">
        <h2>Papers</h2>
        <div class="muted">Manuscripts, revisions, reviewer responses, new ideas.</div>
        <textarea id="papers" placeholder="• Digital auditory battery comfort/tolerability – finalize Discussion
• Financial capacity & cognition perspective – citation tidy‑up
• Dual‑task MCI balance paper – outline Results figs"></textarea>
      </section>

      <section class="card">
        <h2>Data Analysis</h2>
        <div class="muted">Datasets, pipelines, results to review (EEG, HRV, eye tracking, PART, etc.).</div>
        <textarea id="analysis" placeholder="• EEG resting‑state: finalize artifact pipeline
• HRV Polar H10: export lap‑wise metrics
• Eye‑tracking spatial distribution plots: per‑trial visuals
• ANOVA across sessions: table export"></textarea>
      </section>

      <section class="card">
        <h2>Other Updates</h2>
        <div class="muted">Recruitment, collaborations, conferences, admin.</div>
        <textarea id="other" placeholder="• Recruiting via North Oakland Senior Center
• Aging & Health conference travel request
• Lab meeting schedule shift"></textarea>
      </section>

      <section class="card" style="grid-column:1 / -1">
        <h2>Action Items for Next Week</h2>
        <div class="muted">Concrete deliverables with owners/dates.</div>
        <div id="actions" class="checklist"></div>
        <div class="toolbar noprint">
          <button data-add="#actions">+ Add item</button>
          <button id="moveAgendaToActions" class="success" title="Move all checked Agenda items to Action Items">Move checked Agenda → Actions</button>
          <button id="clearActions" class="danger">Clear</button>
        </div>
      </section>
    </div>

    <footer>
      Pro tip: Attach/link this HTML file in your recurring calendar invite. Click it at meeting time → type → Save PDF.
      Data is auto‑saved locally in your browser. Use Export/Import to move between devices.
    </footer>
  </div>

<script>
(function(){
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
  const stateKey = 'mentor_11_agenda_v1';

  const els = {
    mtgDate: $('#mtgDate'),
    mentor: $('#mentor'),
    links: $('#links'),
    linkLabel: $('#linkLabel'),
    linkUrl: $('#linkUrl'),
    addLink: $('#addLink'),
    clearLinks: $('#clearLinks'),
    followups: $('#followups'),
    agenda: $('#agenda'),
    actions: $('#actions'),
    grants: $('#grants'),
    papers: $('#papers'),
    analysis: $('#analysis'),
    other: $('#other'),
    pdfBtn: $('#pdfBtn'),
    newBtn: $('#newBtn'),
    exportBtn: $('#exportBtn'),
    importBtn: $('#importBtn'),
    importFile: $('#importFile'),
    carryFollowups: $('#carryFollowups'),
    moveAgendaToActions: $('#moveAgendaToActions'),
    clearFollowups: $('#clearFollowups'),
    clearAgenda: $('#clearAgenda'),
    clearActions: $('#clearActions'),
  };

  const todayISO = new Date().toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' });

  // Checklist helpers
  function newItem(text='', checked=false){
    const div = document.createElement('div');
    div.className = 'li';
    div.innerHTML = `
      <input type="checkbox" ${checked? 'checked':''}>
      <input type="text" placeholder="Describe the item…" value="${escapeHtml(text)}">
      <button class="del">✕</button>
    `;
    const cb = div.querySelector('input[type="checkbox"]');
    const txt = div.querySelector('input[type="text"]');
    const del = div.querySelector('.del');
    cb.addEventListener('change', save);
    txt.addEventListener('input', debounce(save, 150));
    del.addEventListener('click', ()=>{ div.remove(); save(); });
    return div;
  }

  function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

  function listToState(listEl){
    return $$('.li', listEl).map(li=>({
      text: li.querySelector('input[type="text"]').value || '',
      checked: li.querySelector('input[type="checkbox"]').checked
    }));
  }

  function stateToList(listEl, items){
    listEl.innerHTML='';
    (items||[]).forEach(it=> listEl.appendChild(newItem(it.text, it.checked)));
  }

  function addItemTo(sel){
    const el = $(sel);
    el.appendChild(newItem());
    save();
  }

  // Persistence
  function read(){ try { return JSON.parse(localStorage.getItem(stateKey)||'{}'); } catch(e){ return {}; } }
  function write(data){ localStorage.setItem(stateKey, JSON.stringify(data)); }

  function collect(){
    return {
      mtgDate: els.mtgDate.value,
      mentor: els.mentor.value,
      links: $$('.pill', els.links).map(a=>({ label:a.textContent.trim(), url:a.href })),
      followups: listToState(els.followups),
      agenda: listToState(els.agenda),
      actions: listToState(els.actions),
      grants: els.grants.value,
      papers: els.papers.value,
      analysis: els.analysis.value,
      other: els.other.value,
      ts: Date.now()
    };
  }

  function populate(data){
    els.mtgDate.value = data.mtgDate || todayISO;
    els.mentor.value = data.mentor || '';
    // links
    els.links.innerHTML='';
    (data.links||[]).forEach(({label,url})=> addLink(label,url));
    // lists
    stateToList(els.followups, data.followups||[]);
    stateToList(els.agenda, data.agenda||[]);
    stateToList(els.actions, data.actions||[]);
    // text areas
    els.grants.value = data.grants|| els.grants.placeholder;
    els.papers.value = data.papers|| els.papers.placeholder;
    els.analysis.value = data.analysis|| els.analysis.placeholder;
    els.other.value = data.other|| els.other.placeholder;
  }

  function save(){ write(collect()); }
  const debounce = (fn, ms=200) => { let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args), ms); } };

  // Links
  function addLink(label, url){
    if(!label || !url) return;
    const a = document.createElement('a');
    a.className='pill'; a.textContent=label; a.href=url; a.target='_blank';
    els.links.appendChild(a); save();
  }

  // Wiring
  $('[data-add="#followups"]').addEventListener('click', ()=> addItemTo('#followups'));
  $('[data-add="#agenda"]').addEventListener('click', ()=> addItemTo('#agenda'));
  $('[data-add="#actions"]').addEventListener('click', ()=> addItemTo('#actions'));

  els.addLink.addEventListener('click',()=>{
    const label = els.linkLabel.value.trim();
    const url = els.linkUrl.value.trim();
    if(!label || !url) return;
    addLink(label,url);
    els.linkLabel.value=''; els.linkUrl.value='';
  });
  els.clearLinks.addEventListener('click',()=>{ els.links.innerHTML=''; save(); });

  els.mtgDate.addEventListener('input', debounce(save,150));
  els.mentor.addEventListener('input', debounce(save,150));
  els.grants.addEventListener('input', debounce(save,150));
  els.papers.addEventListener('input', debounce(save,150));
  els.analysis.addEventListener('input', debounce(save,150));
  els.other.addEventListener('input', debounce(save,150));

  els.pdfBtn.addEventListener('click', ()=> window.print());

  els.newBtn.addEventListener('click', ()=>{
    if(!confirm('Start a fresh agenda for this week? This clears text & lists (links stay).')) return;
    const data = read();
    const keepLinks = data.links || [];
    populate({ links: keepLinks });
    save();
  });

  els.exportBtn.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(collect(), null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    const d = new Date();
    a.download = `mentor_11_agenda_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}.json`;
    a.click();
  });

  els.importBtn.addEventListener('click', ()=> els.importFile.click());
  els.importFile.addEventListener('change', e=>{
    const file = e.target.files[0]; if(!file) return;
    const fr = new FileReader();
    fr.onload = ()=>{
      try{ const data = JSON.parse(fr.result); populate(data); save(); }
      catch(err){ alert('Invalid JSON'); }
    };
    fr.readAsText(file);
  });

  // Carry over unchecked followups to agenda
  els.carryFollowups.addEventListener('click',()=>{
    const items = listToState(els.followups).filter(x=>!x.checked);
    const existing = listToState(els.agenda);
    stateToList(els.agenda, existing.concat(items.map(x=>({...x, checked:false}))));
    save();
  });
  // Move checked agenda → actions
  els.moveAgendaToActions.addEventListener('click',()=>{
    const agendaItems = listToState(els.agenda);
    const move = agendaItems.filter(x=>x.checked).map(x=>({text:x.text, checked:false}));
    const keep = agendaItems.filter(x=>!x.checked);
    const actionsItems = listToState(els.actions);
    stateToList(els.actions, actionsItems.concat(move));
    stateToList(els.agenda, keep);
    save();
  });

  els.clearFollowups.addEventListener('click',()=>{ if(confirm('Clear Follow‑ups?')) { els.followups.innerHTML=''; save(); }});
  els.clearAgenda.addEventListener('click',()=>{ if(confirm('Clear Agenda?')) { els.agenda.innerHTML=''; save(); }});
  els.clearActions.addEventListener('click',()=>{ if(confirm('Clear Action Items?')) { els.actions.innerHTML=''; save(); }});

  // Init
  const initial = read();
  if(!initial.mtgDate){ initial.mtgDate = todayISO; }
  populate(initial);
})();
</script>
</body>
</html>
